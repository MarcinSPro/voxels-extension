function loadStats(){premium?loadStatsSetup():displayPremium()}function loadStatsSetup(){let e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-stats","pixel-border");var a=document.createElement("div");a.classList.add("voxels-stats-header");var s=document.createElement("div");s.classList.add("voxels-stats-navigator");var l=document.createElement("div");l.classList.add("voxels-stats-nav-item","clickable","voxels-stats-active"),l.textContent="Stats";var i=document.createElement("div");i.classList.add("voxels-stats-nav-item","clickable"),i.textContent="Leaderboard";var n=document.createElement("div");n.classList.add("voxels-nav-divider"),s.appendChild(l),s.appendChild(n),s.appendChild(i),a.appendChild(s);var d=document.createElement("img");d.classList.add("voxels-stats-update"),d.src=chrome.runtime.getURL("/images/icons/icon__refresh.svg");let r=limiter(refreshStats,1e4);d.addEventListener("click",function(){r()}),a.appendChild(d),t.appendChild(a);var o=document.createElement("div");o.classList.add("voxels-stats-page"),t.appendChild(o),e.appendChild(t),l.addEventListener("click",function(){loadStatsPage("stats"),l.classList.add("voxels-stats-active"),i.classList.remove("voxels-stats-active")}),i.addEventListener("click",function(){loadStatsPage("leaderboard"),l.classList.remove("voxels-stats-active"),i.classList.add("voxels-stats-active")}),refreshStats()}function refreshStats(){chrome.storage.local.get("pid",async function(e){let t=e.pid;loadingScreen(1);try{let a=await makeFetchRequest(apiURL,{pid:t,operation:"getPlayerStats"});if(!handleErrors(a)){if("logout"==a)initiate();else{loadingScreen(0);let s=document.querySelector(".voxels-stats-nav-item.voxels-stats-active");chrome.storage.local.set({stats:a.data},function(){loadStatsPage(s.textContent.toLowerCase())})}}}catch(l){console.error(l)}})}function loadStatsPage(e){chrome.storage.local.get(["stats","user_info"],function(t){clearStatsPage();let a=document.querySelector(".voxels-stats-page"),s=t.user_info;var l=new Date,i=l.getUTCDate()+"/"+(l.getUTCMonth()+1)+"/"+l.getUTCFullYear();if("stats"===e){userStats=t.stats.stats;let n=userStats.per_day,d=userStats.extra,r=userStats.individual_tasks,o=userStats.task_timestamp,c=document.createElement("div");c.classList.add("voxels-stats-basics");let p=document.createElement("div");if(p.classList.add("voxels-stats-name","clickable"),"world"in d?p.innerHTML=`${d.username} <span>- World</span> ${d.world}`:p.innerHTML=`${d.username} <span>- Offline</span>`,c.appendChild(p),p.addEventListener("click",function(){loadPlayerPageTop(),loadPlayerPage(d.PID)}),"vip"in d){let m=document.createElement("div");m.classList.add("voxels-stats-field");let v=new Date(d.vip),x=v.toLocaleString();m.innerHTML=`<span>VIP: expires</span> ${x}`,c.appendChild(m)}let g=document.createElement("div");g.classList.add("voxels-stats-field");let h=d.pixels,u=d.total_value_usd.toFixed(2),L=(u/h).toFixed(2);g.innerHTML="<span>Pixels: </span>"+h+" <img src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'><span> = "+u+"$</span> (1 <img src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'> = ~"+L+"$)",c.appendChild(g);let C=document.createElement("div");C.classList.add("voxels-stats-field");let k=d.level;C.innerHTML="<span>Overall level: </span>"+k,c.appendChild(C),data=statsCalculations(n);let f=document.createElement("div");f.classList.add("voxels-stats-earnings");let E=new Date,b=E.toISOString().split("T")[0],$=E.getUTCDate(),y=E.getUTCMonth()+1,w,P,T,M,S=0;for(var U=0;U<n.length;U++)n[U].date===b&&(w=data[U].pixels_made,P=data[U].coins_total,T=data[U].c_p_ratio.toFixed(2),M=data[U].tasks_done,S=data[U].pixel_tasks);f.innerHTML="Earnings <span>("+$+"/"+y+")</span>";let I=["Pixels made","Coins spent","Coins spent per pixel","Tasks done","Pixel tasks"],_=[w,P,T,M,S],H=[`<img src="${chrome.runtime.getURL("images/Other/Pixel.png")}">`,`<img src="${chrome.runtime.getURL("images/Prices/coin.png")}">`,`<img src="${chrome.runtime.getURL("images/Prices/coin.png")}">`,"",""];for(let R=0;R<I.length;R++){let O=document.createElement("div");O.classList.add("voxels-stats-field");let V="Pixels made"===I[R]||"Coins spent"===I[R]||"Coins spent per pixel"===I[R]?H[R]+" ":"";O.innerHTML=`<span>${I[R]}:</span> ${V}${_[R]}`,f.appendChild(O)}c.appendChild(f),a.appendChild(c),a.appendChild(createIndividualTasks(r,o));let B=document.createElement("div");function D(e,t,s){var l,i,n,d=document.createElement("div");d.classList.add("voxels-main-info"),a.appendChild(d);var r=(l=e,i=d,(n=document.createElement("canvas")).id=l,n.style.width="100%",n.style.maxWidth="600px",i.appendChild(n),n.getContext("2d"));new Chart(r,{type:"line",data:t,options:s})}B.classList.add("voxels-stats-earnings","voxels-stats-earnings-graph"),B.innerHTML="Graphs",a.appendChild(B);var F={responsive:!0,interaction:{mode:"index",intersect:!1},stacked:!1,plugins:{title:{display:!1,text:"Earnings Chart",color:"white"},legend:{labels:{color:"white"}},tooltip:{titleColor:"white",bodyColor:"white",backgroundColor:"black"}},scales:{x:{grid:{color:e=>0===e.tick.value?"white":"transparent"},ticks:{color:"white"}},y:{beginAtZero:!0,grid:{color:e=>0===e.tick.value?"white":"rgba(255, 255, 255, 0.2)"},border:{dash:e=>0===e.tick.value?[]:[2,4]},ticks:{color:"white"}}}};function q(e,t){var a=[],s=t.map(t=>(function e(t,a,s,l,i,n){for(var d={data:[],label:l,borderColor:i,backgroundColor:i,fill:!1,tension:.4},r=s;r>=0;r--){var o=new Date;o.setUTCDate(o.getUTCDate()-r);var c,p=o.toISOString().split("T")[0],m=o.getUTCDate()+"/"+(o.getUTCMonth()+1);n.includes(m)||n.push(m);for(var v=!1,x=0;x<t.length;x++)if(t[x].date===p){v=!0,d.data.push(t[x][a]);break}v||d.data.push(0)}return d})(e,t.key,t.maxItems,t.label,t.color,a));return{labels:a,datasets:s}}D("chartCanvas1",q(data,[{key:"pixels_made",maxItems:6,label:"Pixels made",color:"#5ff600"}]),F),D("chartCanvas2",q(data,[{key:"coins_made",maxItems:6,label:"Coins made",color:"#e3ff36"},{key:"coins_spent",maxItems:6,label:"Coins spent",color:"#f75543"},{key:"coins_total",maxItems:6,label:"Coins total",color:"#f7af43"},{key:"c_p_ratio",maxItems:6,label:"Coins spent/Pixel",color:"#c2fa0a"}]),F),D("chartCanvas3",q(data,[{key:"tasks_done",maxItems:6,label:"Tasks",color:"#0a0efa"},{key:"pixel_tasks",maxItems:6,label:"Pixel tasks",color:"#0afada"},{key:"t_p_ratio",maxItems:6,label:"Tasks/Pixel",color:"#0afa7a"},{key:"pixel_percentage",maxItems:6,label:"% Pixel tasks",color:"#7e0afa"},{key:"pixel_per_pixel_task",maxItems:6,label:"Pixel per Pixel task",color:"#198a2f"}]),F)}else if("leaderboard"===e){let Y=t.stats.leaderboard,A=t.stats.minimumLevel,W=Y.season_active;if(W){let j=Y.season,z=Y.season_info,G=Y.season_prize;var Z=document.createElement("div");Z.classList.add("voxels-season");var J=document.createElement("div");J.classList.add("voxels-season-title");let K=new Date(z.season_start),N=new Date(z.season_end),Q=K.getDate()+"/"+(K.getMonth()+1)+"/"+K.getFullYear(),X=N.getDate()+"/"+(N.getMonth()+1)+"/"+K.getFullYear();J.innerHTML="<p class='voxels-text-color-main'>Voxels Season "+z.season_number+"</p> ("+Q+" - "+X+")",Z.appendChild(J);var ee=document.createElement("div");ee.classList.add("voxels-season-table"),Z.appendChild(ee);for(var et=0;et<j.length;et++){var ea=document.createElement("div");ea.classList.add("voxels-leaderboard-row");var es=document.createElement("div");es.classList.add("voxels-leaderboard-column","voxels-text-color-main"),10==et?es.textContent="You":es.innerHTML=et+1+" <span>"+G[et]+"<br><img class='voxels-leaderboard-pixels-icon' src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'></span>",ea.appendChild(es);var el=document.createElement("div");el.classList.add("voxels-leaderboard-column"),el.textContent=j[et].username,j[et].username===s&&el.classList.add("voxels-text-color-main"),ea.appendChild(el);var ei=document.createElement("div");ei.classList.add("voxels-leaderboard-column","voxels-text-color-main"),ei.textContent=j[et].pixels_made,ea.appendChild(ei),ee.appendChild(ea)}a.appendChild(Z)}let en=Y.day;var ed=document.createElement("div");ed.classList.add("voxels-leaderboard");var J=document.createElement("div");J.classList.add("voxels-leaderboard-title"),J.innerHTML="<span class='voxels-text-color-main'>Leaderboard</span> ("+i+") <img class='voxels-leaderboard-pixels-icon' src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'>",ed.appendChild(J);var er=document.createElement("div");er.classList.add("voxels-leaderboard-table"),ed.appendChild(er);for(var et=0;et<en.length;et++)!function(e){var t=document.createElement("div");t.classList.add("voxels-leaderboard-row","clickable");var a=document.createElement("div");a.classList.add("voxels-leaderboard-column","voxels-text-color-main"),a.textContent=e+1,t.appendChild(a);var l=document.createElement("div");l.classList.add("voxels-leaderboard-column","clickable"),l.textContent=en[e].username,en[e].username===s&&l.classList.add("voxels-text-color-main"),t.appendChild(l);var i=document.createElement("div");i.classList.add("voxels-leaderboard-column","voxels-text-color-main"),i.textContent=en[e].pixels_made,t.appendChild(i);var n=document.createElement("div");n.classList.add("voxels-details-container"),n.style.display="none";var d=document.createElement("div");d.classList.add("voxels-details-row");var r=document.createElement("div");r.classList.add("voxels-details-level");var o=document.createElement("div");o.classList.add("voxels-playerpage-skill-level"),o.innerHTML="<span class='voxels-playerpage-levelicon-prefix'>Lvl</span>"+en[e].level,r.appendChild(o),d.appendChild(r);var c=document.createElement("div");c.classList.add("voxels-details-lands"),c.innerHTML=" "+en[e].lands;var p=document.createElement("img");p.src=chrome.runtime.getURL("images/pixels_icon.png"),c.prepend(p),d.appendChild(c);var m=document.createElement("div");m.classList.add("voxels-details-vip"),m.classList.add("voxels-details-vip"),en[e].vip&&m.classList.add("js-completed"),m.innerHTML="VIP&nbsp;";var v=document.createElement("img");v.src=en[e].vip?chrome.runtime.getURL("images/icons/icon__task.svg"):chrome.runtime.getURL("images/icons/icon__xmark.svg"),m.appendChild(v),d.appendChild(m),n.appendChild(d);var x=document.createElement("div");x.classList.add("voxels-details-row","voxels-details-calc");var g=document.createElement("div");g.classList.add("voxels-details-column"),g.innerHTML=' Coins Spent: <span class="voxels-details-calc-number">'+nFormatter(en[e].coins_spent,3)+"</span>",x.appendChild(g),n.appendChild(x);var h=document.createElement("div");h.classList.add("voxels-details-row","voxels-details-calc");var u=document.createElement("div");u.classList.add("voxels-details-column"),u.innerHTML=' Coins per Pixel: <span class="voxels-details-calc-number">'+nFormatter(en[e].c_p_ratio,3)+"</span>",h.appendChild(u),n.appendChild(h);var L=document.createElement("div");L.classList.add("voxels-details-row","voxels-details-calc");var C=document.createElement("div");C.classList.add("voxels-details-column"),C.innerHTML=' Tasks done: <span class="voxels-details-calc-number">'+en[e].tasks_done+"</span>",L.appendChild(C),n.appendChild(L);var k=document.createElement("div");k.classList.add("voxels-details-row");var f=document.createElement("div");f.classList.add("voxels-details-button");var E=document.createElement("button");E.textContent="Profile page";let b=en[e].pid;E.addEventListener("click",function(){loadPlayerPageTop(),loadPlayerPage(b)}),f.appendChild(E),k.appendChild(f),n.appendChild(k),t.addEventListener("click",function(){n.style.display="none"===n.style.display?"block":"none"}),er.appendChild(t),er.appendChild(n)}(et);if(a.appendChild(ed),A){let eo=document.createElement("div");eo.classList.add("voxels-stats-min-section-title"),eo.innerText="Minimum Levels Required for Tasks",a.appendChild(eo),appendMinimumLevelsToPage(a,A)}var ec=document.createElement("div");if(ec.classList.add("voxels-stats-info"),ec.textContent="Stats get updated every 15 min.",a.appendChild(ec),!t.stats.stats.extra.optout){var ep=document.createElement("div");ep.classList.add("voxels-stats-info"),ep.innerHTML='To opt out of the leaderboard and Voxels Seasons you can click <a href="#" id="optOutLink">here</a>.',a.appendChild(ep),document.getElementById("optOutLink").addEventListener("click",function(e){e.preventDefault(),userOptout(t.stats.stats.extra.PID)})}}})}function appendMinimumLevelsToPage(e,t){for(let[a,s]of Object.entries(t)){let l=Object.entries(s).map(([e,t])=>Object.entries(t).map(([t,a])=>({item:e,reward:parseFloat(t),level:a.level}))).flat().sort((e,t)=>t.reward===e.reward?t.level-e.level:t.reward-e.reward),i=document.createElement("div");i.classList.add("voxels-stats-tasks-section","voxels-stats-skill-section");let n=e=>{let t=displayNamesJSONArray.find(t=>t.display_name===e);return t?t.image:""},d=document.createElement("div");d.classList.add("voxels-stats-tasks-section-title"),d.innerHTML=`<img src="https://d31ss916pli4td.cloudfront.net/game/ui/skills/skills_icon_${a}.png?v2">&nbsp;${a.charAt(0).toUpperCase()+a.slice(1)}`,i.appendChild(d);let r=document.createElement("table");r.classList.add("voxels-stats-skill-table");let o=document.createElement("tr");o.innerHTML=`
            <th>Item</th>
            <th>Pixels</th>
            <th>Minimum Level</th>
        `,r.appendChild(o),l.forEach(e=>{let t=n(e.item),a=document.createElement("tr");a.innerHTML=`
                <td><img src="${t}" class="task-item-image"> <span>${e.item}</span></td>
                <td><img src="${chrome.runtime.getURL("/images/Other/Pixel.png")}" class="pixel-image">${e.reward}</td>
                <td>${e.level}</td>
            `,r.appendChild(a)}),i.appendChild(r),e.appendChild(i)}}function createIndividualTasks(e,t){let a=document.createElement("div");a.classList.add("voxels-stats-basics");let s=document.createElement("div");if(s.classList.add("voxels-stats-earnings"),s.innerHTML="Tasks (last 24h)",null!==t){let l=document.createElement("div");l.classList.add("voxels-stats-last-task");let i=new Date(1e3*t).toLocaleString();l.innerHTML=`Last task delivered: <span>${i}</span>`,s.appendChild(l)}let n={0:"Basic",1:"VIP",2:"Landowner"},d={};e.sort((e,t)=>e.reward_type!==t.reward_type?e.reward_type.localeCompare(t.reward_type):parseFloat(e.reward_amount)!==parseFloat(t.reward_amount)?parseFloat(t.reward_amount)-parseFloat(e.reward_amount):e.task_item!==t.task_item?e.task_item.localeCompare(t.task_item):e.type-t.type),e.forEach(e=>{if("pixels"===e.reward_type){let t=`${e.task_item}_${e.reward_amount}`;d[t]||(d[t]={task_item:e.task_item,reward_amount:e.reward_amount,types:{}});let a=n[e.type];d[t].types[a]||(d[t].types[a]=0),d[t].types[a]++}});let r=e=>{let t=displayNamesJSONArray.find(t=>t.display_name===e);return t?t.image:""},o=document.createElement("div");o.classList.add("voxels-stats-tasks-section");let c={Basic:0,VIP:0,Landowner:0};Object.values(d).forEach(e=>{c.Basic+=(e.types.Basic||0)*parseFloat(e.reward_amount),c.VIP+=(e.types.VIP||0)*parseFloat(e.reward_amount),c.Landowner+=(e.types.Landowner||0)*parseFloat(e.reward_amount)}),c.Basic=c.Basic.toFixed(1),c.VIP=c.VIP.toFixed(1),c.Landowner=c.Landowner.toFixed(1),o.innerHTML=`
    <div class="voxels-stats-tasks-section-title">
        <img src="${chrome.runtime.getURL("/images/Other/Pixel.png")}" class="pixel-image">&nbsp;Pixel tasks
    </div>
    <div class="voxels-stats-tasks-section-totals">
        <div>Pixels Basic:&nbsp;<img src="${chrome.runtime.getURL("/images/Other/Pixel.png")}" class="pixel-image">${c.Basic}</div>
        <div>Pixels&nbsp;<img src="${chrome.runtime.getURL("/images/Other/vip_coupon.png")}" class="header-image">:&nbsp;<img src="${chrome.runtime.getURL("/images/Other/Pixel.png")}" class="pixel-image">${c.VIP}</div>
        <div>Pixels&nbsp;<img src="${chrome.runtime.getURL("/images/pixels_icon.png")}" class="header-image header-pixels">:&nbsp;<img src="${chrome.runtime.getURL("/images/Other/Pixel.png")}" class="pixel-image">${c.Landowner}</div>
    </div>
`;let p=document.createElement("table");p.classList.add("voxels-stats-tasks-table");let m=document.createElement("tr");m.innerHTML=`
    <th>Item</th>
    <th>Pixels</th>
    <th>Basic</th>
    <th><img src="${chrome.runtime.getURL("/images/Other/vip_coupon.png")}" class="header-image"></th>
    <th><img src="${chrome.runtime.getURL("/images/pixels_icon.png")}" class="header-image header-pixels"></th>
`,p.appendChild(m),Object.values(d).forEach(e=>{let t=e.task_item,a=r(t),s=parseFloat(e.reward_amount).toString(),l=e.types.Basic||0,i=e.types.VIP||0,n=e.types.Landowner||0,d=document.createElement("tr");d.innerHTML=`
        <td><img src="${a}" class="task-item-image"> <span>${t}</span></td>
        <td><img src="${chrome.runtime.getURL("/images/Other/Pixel.png")}" class="pixel-image">${s}</td>
        <td>${l}</td>
        <td>${i}</td>
        <td>${n}</td>
    `,p.appendChild(d)}),o.appendChild(p),s.appendChild(o);let v={};e.forEach(e=>{if("pixels"!==e.reward_type){let t=`${e.task_item}_${e.reward_amount}`;v[t]||(v[t]={task_item:e.task_item,reward_amount:e.reward_amount,types:{}});let a=n[e.type];v[t].types[a]||(v[t].types[a]=0),v[t].types[a]++}});let x=document.createElement("div");x.classList.add("voxels-stats-tasks-section"),x.innerHTML='<div class="voxels-stats-tasks-section-title"><img src="'+chrome.runtime.getURL("/images/Prices/coin.png")+'">&nbsp;Coin tasks</div>';let g=document.createElement("table");g.classList.add("voxels-stats-tasks-table");let h=document.createElement("tr");return h.innerHTML=`
    <th>Item</th>
    <th>Coins</th>
    <th>Basic</th>
    <th><img src="${chrome.runtime.getURL("/images/Other/vip_coupon.png")}" class="header-image"></th>
    <th><img src="${chrome.runtime.getURL("/images/pixels_icon.png")}" class="header-image header-pixels"></th>
`,g.appendChild(h),Object.values(v).forEach(e=>{let t=e.task_item,a=r(t),s=nFormatter(parseFloat(e.reward_amount).toString(),2),l=e.types.Basic||0,i=e.types.VIP||0,n=e.types.Landowner||0,d=document.createElement("tr");d.innerHTML=`
        <td><img src="${a}" class="task-item-image"> <span>${t}</span></td>
        <td><img src="${chrome.runtime.getURL("/images/Prices/coin.png")}" class="coin-image">${s}</td>
        <td>${l}</td>
        <td>${i}</td>
        <td>${n}</td>
    `,g.appendChild(d)}),x.appendChild(g),s.appendChild(x),a.appendChild(s),a}function userOptout(e){voxelsConfirm("If you continue you won't be able to participate in this Voxels Season or the Leaderboard. Opt out?",function(t){t&&chrome.storage.local.get("user_info",async function(t){let a=t.user_info;loadingScreen(1);try{let s=await makeFetchRequest(apiURL,{name:a,operation:"leaderboardOptout",extra:e});handleErrors(s)||("logout"==s?initiate():(loadingScreen(0),refreshStats(),quickMessage("You have opted out of Voxels Seasons & the leaderboard.","news")))}catch(l){console.error(l)}})})}function statsCalculations(e){let t=new Date().toISOString().slice(0,10),a=e.some(e=>e.date===t);return a||e.push({date:t,pixels_made:0,coins_made:0,coins_spent:0,tasks_done:0,pixel_tasks:0,coins_total:0,c_p_ratio:0,t_p_ratio:0,pixel_percentage:0,normal_tasks:0}),e.forEach(e=>{let t=e.pixels_made,a=e.coins_made,s=e.coins_spent,l=e.tasks_done,i=e.pixel_tasks,n=s-a;e.coins_spent*=-1,e.coins_total=-1*n,e.c_p_ratio=t>0?n/t:0,e.t_p_ratio=t>0?l/t:0,e.pixel_percentage=l>0?i/l*100:0,e.pixel_per_pixel_task=t>0?t/i:0,e.normal_tasks=l-i}),e}function clearStatsPage(){document.querySelector(".voxels-stats-page").innerHTML=""}
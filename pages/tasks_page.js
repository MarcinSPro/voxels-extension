var currentTasksElements;function loadTasks(e){premium?chrome.storage.local.get("task_data",function(e){e.task_data?loadTaskPage(e.task_data):loadTaskPage(!1)}):displayPremium()}function loadTaskPage(e){reloadOverlay(),loadTitleSection("tasks");let t=document.querySelector(".voxels-main");if(!1===e){var a=document.createElement("div");a.classList.add("voxels-main-new"),t.appendChild(a);var s=document.createElement("div");s.textContent="Open the tasks in Buck's Galore first.",a.appendChild(s)}else t.appendChild(createTaskContainer(e)),setTasksCost(),setTaskQuantities()}function createTaskContainer(e){var t=document.createElement("div");return t.classList.add("voxels-task-items-container"),e.forEach(e=>{var a=document.createElement("div");a.classList.add("voxels-task-item");var s=document.createElement("div");s.classList.add("voxels-task-item-visual"),a.appendChild(s);var n=document.createElement("img");if(n.src=e.image,s.appendChild(n),"Loading..."!==e.name){var o=document.createElement("div");o.classList.add("voxels-task-total-cost"),s.appendChild(o);var r=document.createElement("div");r.classList.add("voxels-task-quantity","voxels-task-main-quantity"),r.textContent=e.quantity,a.appendChild(r);var l=document.createElement("div");l.classList.add("voxels-task-name"),l.textContent=e.name,a.appendChild(l);var i=document.createElement("div");i.classList.add("voxels-task-cost-container");var c=document.createElement("img");c.src=e.costType,i.appendChild(c);var d=document.createElement("div");d.classList.add("voxels-task-cost"),d.textContent=e.cost,i.appendChild(d),a.appendChild(i)}else{var l=document.createElement("div");l.classList.add("voxels-task-name","js-voxels-task-name-reload-state");var m=e.finished,u=Date.now(),k=Math.floor((u-m)/1e3);if(void 0===e.finished||k>300)l.textContent="Visit task board to reload..",a.appendChild(l);else{var l=document.createElement("div");l.classList.add("voxels-task-name","js-voxels-task-name-reload-state");var m=e.finished,u=Date.now(),k=Math.floor((u-m)/1e3);if(k>300)l.textContent="Visit task board to reload..",a.appendChild(l);else{var v=300-k,p=Math.floor(v/60),y=v%60;l.textContent="Task will reload in "+p+":"+(y<10?"0":"")+y,a.appendChild(l);var h=setInterval(function(){var e=Math.floor(--v/60),t=v%60;l.textContent="Task will reload in "+e+":"+(t<10?"0":"")+t,v<=0&&(clearInterval(h),l.textContent="Visit task board to reload..")},1e3)}}}t.appendChild(a)}),currentTasksElements=t,t}function checkTasks(){compareTasks().then(e=>{e&&chrome.storage.local.get("task_data",function(e){let t=getCurrentTasks(e);chrome.storage.local.set({task_data:t}),setTaskData(t).then(e=>{"success"===e&&"tasks"===currentActiveTab&&loadTaskPage(t)})})}).catch(e=>{console.log("Error comparing tasks:",e)})}function compareTasks(){return new Promise((e,t)=>{chrome.storage.local.get("task_data",function(t){if(t.task_data){let a=getCurrentTasks(0),s=t.task_data;a.length!==s.length&&e(!0);for(let t=0;t<a.length;t++)compareTaskObjects(a[t],s[t])||e(!0);e(!1)}else e(!0)})})}function compareTaskObjects(e,t){return e.name===t.name&&e.quantity===t.quantity&&e.position===t.position}function setTaskData(e){return new Promise(async(t,a)=>{chrome.storage.local.get("user_info",async function(s){let n={name:s.user_info,operation:"addTasks",extra:e};try{let e=await makeFetchRequest(apiURL,n);t(e.data)}catch(e){a(e)}})})}function getCurrentTasks(e){let t=document.querySelectorAll(nodeNames.tasksCard);if(t.length>0){let a=[];if(0===e){if(t.forEach((e,t)=>{if(!e.classList.contains(nodeNames.tasksTitle)){let s=e.querySelector(nodeNames.tasksTitle);if(s){let n=s.innerText,o,r="";"NEW TASK IN:"===n?n="Loading...":(o=e.querySelectorAll(nodeNames.tasksCostDisplay)[1].querySelector(nodeNames.tasksCostImage).src,r=e.querySelectorAll(nodeNames.tasksCostDisplay)[1].querySelector(nodeNames.tasksCost).innerText);let l=e.querySelector(nodeNames.tasksImage).src,i=e.querySelector(nodeNames.tasksQuantity),c={name:n,quantity:i?parseInt(i.innerText,10):1,image:l,costType:o,cost:r,position:t};if("Loading..."===n){let e=Date.now();c.finished=e}a.push(c)}}}),a.length>0)return a}else{let a=e.task_data;return t.forEach((e,t)=>{if(!e.classList.contains(nodeNames.tasksTitle)){let s=e.querySelector(nodeNames.tasksTitle);if(s){let n=s.innerText,o,r="";"NEW TASK IN:"===n?n="Loading...":(o=e.querySelectorAll(nodeNames.tasksCostDisplay)[1].querySelector(nodeNames.tasksCostImage).src,r=e.querySelectorAll(nodeNames.tasksCostDisplay)[1].querySelector(nodeNames.tasksCost).innerText);let l=e.querySelector(nodeNames.tasksImage).src,i=e.querySelector(nodeNames.tasksQuantity),c={name:n,quantity:i?parseInt(i.innerText,10):1,image:l,costType:o,cost:r,position:t};if("Loading..."===n){let e=Date.now();c.finished=e}compareTaskObjects(c,a[t])||(a[t]=c)}}}),a}}}function setTasksCost(){"tasks"==currentActiveTab&&chrome.storage.local.get("task_data",async function(e){loadTasksCost(e.task_data.map(e=>e.name)).then(e=>{e.forEach((e,t)=>{let a=currentTasksElements.querySelector(`.voxels-task-item:nth-child(${t+1})`);if(a&&null!==e.price){let t=a.querySelector(".voxels-task-main-quantity"),n=t?parseInt(t.textContent,10):1;var s=parseInt(e.price,10)*n;s=s>9999?nFormatter(s,1):s;let o=a.querySelector(".voxels-task-total-cost");o&&(o.innerHTML=`<div>Total:</div><div class="voxels-task-total-container"><img src="${chrome.runtime.getURL("images/Prices/coin.png")}">${s}</div>`)}})}).catch(e=>{console.error(e)})})}function loadTasksCost(e){return new Promise(async(t,a)=>{chrome.storage.local.get("user_info",async function(s){let n={name:s.user_info,operation:"fetchPricesByName",extra:e};try{let a=(await makeFetchRequest(apiURL,n)).data,s=e.map(e=>({name:e,price:a[e]}));t(s)}catch(e){a(e)}})})}function setTaskQuantities(){currentFetchedInventory&&currentFetchedInventory.length>0&&document.querySelectorAll(".voxels-task-item").forEach(e=>{if(e.querySelector(".js-voxels-task-name-reload-state"))return;let t=e.querySelector(".voxels-task-name").textContent;e.querySelector(".voxels-task-item-visual img");let a=currentFetchedInventory.find(e=>e.displayName===t),s=a?a.quantity:0,n=e.querySelector(".voxels-task-main-quantity").textContent,o=e.querySelector(".voxels-task-quantity-container");if(o){let e=o.querySelector(".voxels-task-quantity:first-child");e&&(e.textContent=s)}else(o=document.createElement("div")).className="voxels-task-quantity-container",o.innerHTML=`<div class="voxels-task-quantity">${s}</div>/<div class="voxels-task-quantity voxels-task-main-quantity">${n}</div>`,e.querySelector(".voxels-task-quantity").replaceWith(o);s>=n?e.classList.add("voxels-task-achievable"):e.classList.remove("voxels-task-achievable")})}
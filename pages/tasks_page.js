var currentTasksElements;function loadTasks(t){premium?chrome.storage.local.get("task_data",function(t){t.task_data?loadTaskPage(t.task_data):loadTaskPage(!1)}):displayPremium()}function loadTaskPage(t){reloadOverlay(),loadTitleSection("tasks");let e=document.querySelector(".voxels-main");if(!1===t){var a=document.createElement("div");a.classList.add("voxels-main-tasks"),e.appendChild(a);var s=document.createElement("div");s.textContent="Open the tasks to start.",a.appendChild(s)}else e.appendChild(createTaskContainer(t)),setTasksCost(),addTaskQuantities()}function createTaskContainer(t){var e=document.createElement("div");return e.classList.add("voxels-task-items-container"),t.forEach(t=>{var a=document.createElement("div");a.classList.add("voxels-task-item");var s=document.createElement("div");s.classList.add("voxels-task-item-visual"),a.appendChild(s);var n=document.createElement("img");if(n.src=t.image,s.appendChild(n),"VIP"==t.name){a.classList.add("voxels-task-ready");var i=document.createElement("div");i.classList.add("voxels-task-name","js-voxels-task-name-reload-state"),i.textContent=t.name,a.appendChild(i)}else if("Loading..."!==t.name){a.classList.add("voxels-task-ready");var l=document.createElement("div");l.classList.add("voxels-task-total-cost"),s.appendChild(l);var o=document.createElement("div");o.classList.add("voxels-task-quantity","voxels-task-main-quantity"),o.textContent=t.quantity,a.appendChild(o);var i=document.createElement("div");i.classList.add("voxels-task-name"),i.textContent=t.name,a.appendChild(i);var r=document.createElement("div");r.classList.add("voxels-task-cost-container");var c=document.createElement("img");c.src=t.costType,r.appendChild(c);var d=document.createElement("div");d.classList.add("voxels-task-cost"),d.textContent=t.cost,r.appendChild(d),a.appendChild(r),("VIP"===t.type||"Landowner"===t.type)&&("VIP"===t.type?a.classList.add("vip"):"Landowner"===t.type&&a.classList.add("landowner"))}else{var i=document.createElement("div");i.classList.add("voxels-task-name","js-voxels-task-name-reload-state");var k=t.finished,u=Date.now(),v=Math.floor((u-k)/1e3);if(void 0===t.finished||v>300)i.textContent="Visit task board to reload..",a.appendChild(i);else{var i=document.createElement("div");i.classList.add("voxels-task-name","js-voxels-task-name-reload-state");var k=t.finished,u=Date.now(),v=Math.floor((u-k)/1e3);if(v>taskTimerSec)i.textContent="Visit task board to reload..",a.appendChild(i);else{var p=taskTimerSec-v,y=Math.floor(p/60),m=p%60;i.textContent="Task will reload in "+(y+":")+(m<10?"0":"")+m,a.appendChild(i);var f=setInterval(function(){var t=Math.floor(--p/60),e=p%60;i.textContent="Task will reload in "+(t+":")+(e<10?"0":"")+e,p<=0&&(clearInterval(f),i.textContent="Visit task board to reload..")},1e3)}}}e.appendChild(a)}),currentTasksElements=e,e}function checkTasks(){compareTasks().then(t=>{t&&chrome.storage.local.get("task_data",function(t){let e=getCurrentTasks(t);chrome.storage.local.set({task_data:e}),setTaskData(e).then(t=>{"success"===t&&"tasks"===currentActiveTab&&premium&&loadTaskPage(e)})})}).catch(t=>{console.log("Error comparing tasks:",t)})}function compareTasks(){return new Promise((t,e)=>{chrome.storage.local.get("task_data",function(e){if(e.task_data){let a=getCurrentTasks(0),s=e.task_data;a.length!==s.length&&t(!0);for(let n=0;n<a.length;n++)compareTaskObjects(a[n],s[n])||t(!0);t(!1)}else t(!0)})})}function compareTaskObjects(t,e){return t.name===e.name&&t.quantity===e.quantity&&t.position===e.position&&t.cost===e.cost&&t.type===e.type}function setTaskData(t){return new Promise(async(e,a)=>{chrome.storage.local.get("pid",async function(s){let n=s.pid;try{let i=await makeFetchRequest(apiURL,{pid:n,operation:"saveTasks",extra:t});e(i.data)}catch(l){a(l)}})})}function getCurrentTasks(t){let e=document.querySelectorAll(nodeNames.tasksCard);if(e.length>0){let a=[];if(0!==t&&t.task_data){let s=t.task_data||[];return e.forEach((t,e)=>{if(!t.classList.contains(nodeNames.tasksTitle)){let a=t.querySelector(nodeNames.tasksTitle);if(a){let n=a.innerText,i,l="";"NEW TASK IN:"===n?n="Loading...":"vip"===n?n="VIP":(i=t.querySelectorAll(nodeNames.tasksCostDisplay)[1]?.querySelector(nodeNames.tasksCostImage)?.src||"",l=t.querySelectorAll(nodeNames.tasksCostDisplay)[1]?.querySelector(nodeNames.tasksCost)?.innerText||"");let o=t.querySelector(nodeNames.tasksImage)?.src||"",r=t.querySelector(nodeNames.tasksQuantity),c=r?parseInt(r.innerText,10):1,d="Basic",k=t.querySelector(nodeNames.tasksWrapper);k&&(k.classList.contains(nodeNames.tasksVIP)?d="VIP":k.classList.contains(nodeNames.tasksLandowner)&&(d="Landowner"));let u={name:n,quantity:c,image:o,costType:i,cost:l,position:e,type:d};if("Loading..."===n){let v=Date.now();u.finished=v}let p=t.querySelector("button");!p||p.disabled||p.hasAttribute("data-listener-attached")||(p.addEventListener("click",function(){deliverTask(u)}),p.setAttribute("data-listener-attached","true")),e<s.length?compareTaskObjects(u,s[e])||(s[e]=u):s.push(u)}}}),s.length>e.length&&s.splice(e.length),s}if(e.forEach((t,e)=>{if(!t.classList.contains(nodeNames.tasksTitle)){let s=t.querySelector(nodeNames.tasksTitle);if(s){let n=s.innerText,i,l="";"NEW TASK IN:"===n?n="Loading...":"vip"===n?n="VIP":(i=t.querySelectorAll(nodeNames.tasksCostDisplay)[1].querySelector(nodeNames.tasksCostImage).src,l=t.querySelectorAll(nodeNames.tasksCostDisplay)[1].querySelector(nodeNames.tasksCost).innerText);let o=t.querySelector(nodeNames.tasksImage).src,r=t.querySelector(nodeNames.tasksQuantity),c=r?parseInt(r.innerText,10):1,d="Basic",k=t.querySelector(nodeNames.tasksWrapper);k&&(k.classList.contains(nodeNames.tasksVIP)?d="VIP":k.classList.contains(nodeNames.tasksLandowner)&&(d="Landowner"));let u={name:n,quantity:c,image:o,costType:i,cost:l,position:e,type:d};if("Loading..."===n){let v=Date.now();u.finished=v}let p=t.querySelector("button");!p||p.disabled||p.hasAttribute("data-listener-attached")||(p.addEventListener("click",function(){deliverTask(u)}),p.setAttribute("data-listener-attached","true")),a.push(u)}}}),a.length>0)return a}}function deliverTask(t){chrome.storage.local.get("pid",async function(e){let a=e.pid;try{await makeFetchRequestByPID(apiURL,{pid:a,operation:"deliverTask",extra:t})}catch(s){reject(s)}})}function setTasksCost(){"tasks"==currentActiveTab&&chrome.storage.local.get("task_data",async function(t){let e=t.task_data.map(t=>t.name);loadTasksCost(e).then(t=>{t.forEach((t,e)=>{let a=currentTasksElements.querySelector(`.voxels-task-item:nth-child(${e+1})`);if(a&&null!==t.price){let s=a.querySelector(".voxels-task-main-quantity"),n=s?parseInt(s.textContent,10):1;var i=parseInt(t.price,10)*n;i=i>9999?nFormatter(i,1):i;let l=a.querySelector(".voxels-task-total-cost");l&&(l.innerHTML=`<div>Total:</div><div class="voxels-task-total-container"><img src="${chrome.runtime.getURL("images/Prices/coin.png")}">${i}</div>`)}})}).catch(t=>{console.error(t)})})}function loadTasksCost(t){return new Promise(async(e,a)=>{chrome.storage.local.get("user_info",async function(s){let n={name:s.user_info,operation:"fetchPricesByName",extra:t};try{let i=await makeFetchRequest(apiURL,n),l=i.data,o=t.map(t=>({name:t,price:l[t]}));e(o)}catch(r){a(r)}})})}function addTaskQuantities(){if(currentInventory&&currentInventory.items&&currentInventory.items.length>0){let t=new Map;for(let e of currentInventory.items){let a=displayNamesJSONArray.find(t=>t.item===e.item),s=a?a.display_name:e.item;t.has(s)?t.get(s).quantity+=e.quantity:t.set(s,{display_name:s,quantity:e.quantity})}let n=Array.from(t.values());if(n.length>0){let i=document.querySelectorAll(".voxels-task-item");i.forEach(t=>{if(t.querySelector(".js-voxels-task-name-reload-state"))return;let e=t.querySelector(".voxels-task-name").textContent,a=n.find(t=>t.display_name===e),s=a?a.quantity:0,i=t.querySelector(".voxels-task-main-quantity").textContent,l=t.querySelector(".voxels-task-quantity-container");if(l){let o=l.querySelector(".voxels-task-quantity:first-child");o&&(o.textContent=s)}else(l=document.createElement("div")).className="voxels-task-quantity-container",l.innerHTML=`<div class="voxels-task-quantity">${s}</div>/<div class="voxels-task-quantity voxels-task-main-quantity">${i}</div>`,t.querySelector(".voxels-task-quantity").replaceWith(l);s>=i?t.classList.add("voxels-task-achievable"):t.classList.remove("voxels-task-achievable")})}}}
let colorTimerStarted=!1;function loadTimers(e){e?getUserData().then(e=>{handleErrors(e)||loadFarmPage(e)}).catch(e=>{console.log(e)}):chrome.storage.local.get("timer_data",function(e){loadFarmPage(e.timer_data)})}function loadFarmPage(e){let t=document.querySelector(".voxels-main");t.appendChild(addContent(e)).classList.add("active");let a=Object.keys(e).length;a<51&&(a>2?premium&&addNewButton():addNewButton()),premium||displayPremium(),colorTimerStarted||(colorTimerStarted=!0,setInterval(()=>{setTimersBG()},2e3)),t.appendChild(loadHelp())}function addContent(e){var t=document.createElement("div");return t.classList.add("voxels-main-page"),loadFarms(t,e),t}function loadFarms(e,t){for(let[d,m]of Object.entries(t)){let t=d.charAt(0).toUpperCase()+d.slice(1);var a=document.createElement("div");a.classList.add("voxels-main-grid"),a.classList.add("voxels-farm-"+d);var r=document.createElement("div");r.classList.add("voxels-main-title-text"),r.textContent=t,a.appendChild(r);let u=[];u="NuCyber"==d?["nucyber_chip","nucyber_box"]:["coop","apiary","hutch","mine"];var o=document.createElement("div");for(let e of(o.classList.add("voxels-main-farm-icon-container"),u)){var n=document.createElement("div");n.classList.add("voxels-main-farm-icon");var i=document.createElement("img");i.classList.add("voxels-main-farm-image"),i.src=chrome.runtime.getURL("images")+"/Farms/voxels_"+e+".png",i.alt=e+" Image";var l=document.createElement("div");l.classList.add("plus-icon"),l.textContent="+",n.addEventListener("click",function(){addFarm(d,e)}),n.appendChild(i),n.appendChild(l),o.appendChild(n)}a.appendChild(o);var c=document.createElement("div");c.classList.add("voxels-main-remove");var s=document.createElement("div");s.classList.add("voxels-remove-icon"),s.textContent="X",c.addEventListener("click",function(){removeLocation(d)}),c.appendChild(s),a.appendChild(c),loadFarmTypes(d,a,m),e.appendChild(a)}}function loadFarmTypes(e,t,a){let r=0,o=!1;for(let[s,d]of Object.entries(a)){var n=document.createElement("div");n.classList.add("voxels-main-farm-cell"),n.classList.add("voxels-type-"+s);var i=document.createElement("div");i.classList.add("voxels-remove-farm-icon"),i.textContent="âˆ’",i.addEventListener("click",function(){removeFarm(e,s)}),n.appendChild(i);var l=document.createElement("img");l.classList.add("voxels-main-farm-image"),l.src=chrome.runtime.getURL("images")+"/Farms/voxels_"+s+".png",l.alt="Image",n.appendChild(l);var c=createTimer(d);c.addEventListener("click",function(){startTimer(e,s)}),"Start"!==c.textContent&&(o=!0),n.appendChild(c),t.appendChild(n),r++}!0==o&&t.classList.add("voxels-main-grid-active")}function handleResult(e){handleErrors(e)||("logout"==e?initiate():(reloadOverlay(),loadTitleSection("timers"),chrome.storage.local.set({timer_data:e.data}),loadTimers(0)))}function updateFarm(e,t,a){if("logout"==e)initiate();else{let e;switch(a){case"apiary":e=Math.floor(Date.now()/1e3)+2700;break;case"hutch":case"coop":e=Math.floor(Date.now()/1e3)+3600;break;case"mine":e=Math.floor(Date.now()/1e3)+5400;break;case"nucyber_box":case"nucyber_chip":e=Math.floor(Date.now()/1e3)+14400;break;default:console.error("Invalid farmType");return}let r=createTimer(e);r.addEventListener("click",function(){startTimer(t,a)});let o=`.voxels-farm-${t} .voxels-main-farm-cell.voxels-type-${a}`,n=document.querySelector(o),i=`.voxels-farm-${t}`,l=document.querySelector(i);if(l.classList.add("voxels-main-grid-active"),n){let e=n.querySelector(".voxels-main-timer");e&&n.removeChild(e),n.appendChild(r)}else{loadFarmTypes(t,l,{[a]:Math.floor(new Date().getTime()/1e3)}),o=`.voxels-farm-${t} .voxels-main-farm-cell.voxels-type-${a}`;let e=(n=document.querySelector(o)).querySelector(".voxels-main-timer");e&&n.removeChild(e),n.appendChild(r)}}}function removeLocation(e){chrome.storage.local.get("user_info",async function(t){let a=t.user_info;try{let t=await makeFetchRequest(apiURL,{name:a,operation:"removeLocation",extra:e});handleResult(t)}catch(e){console.error(e)}})}function addFarm(e,t){chrome.storage.local.get("user_info",async function(a){let r=a.user_info;try{let a=await makeFetchRequest(apiURL,{name:r,operation:"addFarm",extra:{[e]:t}});if(!handleErrors(a)){if("logout"==a)initiate();else{let r=`.voxels-farm-${e}`,o=document.querySelector(r),n=Math.floor(new Date().getTime()/1e3);chrome.storage.local.set({timer_data:a.data}),loadFarmTypes(e,o,{[t]:n})}}}catch(e){console.error(e)}})}function removeFarm(e,t){chrome.storage.local.get("user_info",async function(a){let r=a.user_info;try{let a=await makeFetchRequest(apiURL,{name:r,operation:"removeFarm",extra:{[e]:t}});if(!handleErrors(a)){if("logout"==a)initiate();else{let r=`.voxels-farm-${e} .voxels-main-farm-cell.voxels-type-${t}`,o=document.querySelector(r);chrome.storage.local.set({timer_data:a.data}),o.remove()}}}catch(e){console.error(e)}})}function startTimer(e,t){chrome.storage.local.get("user_info",async function(a){let r=a.user_info;try{let a=await makeFetchRequest(apiURL,{name:r,operation:"startTimer",extra:{[e]:t}});handleErrors(a)||("logout"==a?initiate():(updateFarm(a,e,t),chrome.storage.local.set({timer_data:a.data})))}catch(e){console.error(e)}})}function startTimerType(e){chrome.storage.local.get("user_info",async function(t){let a=t.user_info,r="",o={name:a,operation:"updateTimer",extra:{[r]:e}};try{let t=await makeFetchRequest(apiURL,o);handleErrors(t)||("logout"==t?initiate():(chrome.storage.local.set({timer_data:t.data.timer_data}),r=t.data.location,"timers"===currentActiveTab&&updateFarm(t,r,e)))}catch(e){console.error(e)}})}function addNewButton(){let e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-new","pixel-border"),e.appendChild(t),t.innerHTML="Add current location",t.addEventListener("click",addButtonClick)}async function addButtonClick(){try{let e=await requestNewLocation();handleResult(e)}catch(e){console.error("Error:",e)}}async function requestNewLocation(){return new Promise((e,t)=>{chrome.storage.local.get("user_info",async function(a){let r=a.user_info;try{let t=await makeFetchRequest(apiURL,{name:r,operation:"add"});if("error"in t.data)e(t);else{let a=t.data;e(a.online?a:{error:"Error 1061"})}}catch(e){t(e)}})})}function createTimer(e){var t=document.createElement("div");function a(){let a=calculateTimeRemaining(e),o=formatTimeRemaining(a);t.textContent=o,a<=0?(clearInterval(r),t.textContent="Start",t.style.backgroundColor="green",t.classList.remove("timer-running")):(t.style.backgroundColor="#2c2c2c",t.classList.contains("timer-running")||t.classList.add("timer-running"))}t.classList.add("voxels-main-timer"),a();var r=setInterval(a,1e3);return t}function calculateTimeRemaining(e){return Math.max(0,e-Math.floor(Date.now()/1e3))}function formatTimeRemaining(e){return`${padZero(Math.floor(e/3600))}:${padZero(Math.floor(e%3600/60))}:${padZero(e%60)}`}function padZero(e){return e<10?`0${e}`:`${e}`}function setTimersBG(){document.querySelectorAll(".voxels-main-grid").forEach(e=>{let t=e.querySelector(".timer-running");t&&!e.classList.contains("voxels-main-grid-active")?e.classList.add("voxels-main-grid-active"):!t&&e.classList.contains("voxels-main-grid-active")&&e.classList.remove("voxels-main-grid-active")})}
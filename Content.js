var startButton,pageContentElement,authInterval,voxels_username,voxels_location="",finalFetchComplete=!1;window.contentScriptReady=!0;const apiURL="https://pixels-api.com/load_data.php";var nodeNames=[],premium=!1;function startLoad(){loadBasicOverlay(),initiate()}function checkForHUD(){let e=document.querySelector(nodeNames.hudTopLeft);e?authUser():setTimeout(checkForHUD,100)}function initiate(){function e(){try{chrome.storage.local.get(["userStatus","auth","premium"],function(e){if(chrome.runtime.lastError){displayInfo({title:"Update!",rows:[{text:"Voxels has received an updated. Please reload this page."}]});return}e.userStatus?(clearInterval(authInterval),getNodeNames(),e.auth?loadTimers(1):startAuthProcess()):displayInfo({title:"How to login:",rows:[{image:"login.png",text:"Click on the extension in the top right corner to sign in."}]})})}catch(e){extensionUpdated()}}authInterval=setInterval(e,1e3),e()}function extensionUpdated(){displayInfo({title:"Update!",rows:[{text:"Voxels has received an updated. Please reload this page."}]})}function startAuthProcess(){displayInfo({title:"Next step:",rows:[{image:"authenticate.png",text:"Click on your player button to link your profile."}]}),checkForHUD()}function getNodeNames(){chrome.storage.local.get("node_info",function(e){void 0!==e.node_info&&(nodeNames=chrome.runtime.lastError?["error"]:e.node_info)})}function displayInfo(e){reloadOverlay();let t=document.querySelector(".voxels-main");var a=document.createElement("div");a.classList.add("voxels-main-top-section"),t.appendChild(a);var n=document.createElement("a");n.classList.add("voxels-main-title"),n.href="https://voxels-extension.com",n.target="_blank",n.textContent="Voxels-Extension.com",a.appendChild(n);var i=document.createElement("div");if(i.classList.add("voxels-main-new"),i.style.display="block",t.appendChild(i),e.rows[0].image){var r=document.createElement("img");r.src=chrome.runtime.getURL("images")+"/Setup/"+e.rows[0].image,r.classList.add("voxels-setup-image"),i.appendChild(r)}var o=document.createElement("p");o.textContent=e.rows[0].text,o.classList.add("voxels-setup-text"),i.appendChild(o)}function authUser(){chrome.storage.local.get(["user_info"],function(e){var t=e.user_info,a=document.querySelector('img[aria-label="Player"]'),n=a.closest("button");function i(){Array.from(document.body.getElementsByTagName("*")).some(function(e){return e.textContent.trim()===t})&&(chrome.storage.local.set({auth:!0}),loadTimers(1),a.style.border="none",n.style.filter="",n.style.opacity="",n.removeEventListener("click",r))}function r(e){setTimeout(i,10)}a.style.border="2px solid red",a.style.borderRadius="15px",n.style.opacity=1,n.style.filter="brightness(150%)",n.addEventListener("click",r)})}function getUserData(){return new Promise((e,t)=>{chrome.storage.local.get("user_info",function(a){let n=a.user_info;n?fetch(apiURL,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({name:n,operation:"requestWithPremium"})}).then(e=>{if(200!==e.status)throw Error("fail");return e.json()}).then(a=>{let n=a.status;if(debugLog(a),"ok"===n){chrome.storage.local.set({timer_data:a.data.timer}),finalFetchComplete=!0;let i=a.data.premium.premium;if(i){let r=a.data.premium.premium_end,o=Math.floor(Date.now()/1e3);r>o&&(r-o<172800&&showAlert('Your premium runs out within the next 2 days! Renew now on <a href="https://voxels-extension.com/premium/" target="_blank">Voxels</a>!',"info"),premium=i,startChecker())}e(a.data.timer)}else console.log("Error in fetching user data:",a.error),t(Error(a.error))}).catch(e=>{console.log(e),t(Error("Failed to fetch user data"))}):t(Error("Voxels username not available in storage."))})})}function loadBasicOverlay(){var e=document.createElement("div");e.classList.add("voxels-main-container"),document.body.appendChild(e);var t=document.createElement("div");t.classList.add("voxels-main-trapezium"),e.appendChild(t);var a=document.createElement("div");a.classList.add("voxels-main-arrow-down"),t.appendChild(a);var n=!0;function i(){n?(e.style.transform="translateY(calc(100% - 25px))",a.classList.add("voxels-main-flipped")):(e.style.transform="translateY(0)",a.classList.remove("voxels-main-flipped")),n=!n}t.addEventListener("click",i),document.addEventListener("keydown",function(e){"v"===e.key&&i()});var r=document.createElement("div");r.classList.add("voxels-main"),e.appendChild(r)}function reloadOverlay(){let e=document.querySelector(".voxels-main");e.innerHTML=""}function loadTimers(e){reloadOverlay(),e?getUserData().then(e=>{handleErrors(e)||loadFarmPage(e)}).catch(e=>{console.log(e)}):chrome.storage.local.get("timer_data",function(e){loadFarmPage(e.timer_data)})}function loadFarmPage(e){let t=document.querySelector(".voxels-main");loadTitleSection(t),t.appendChild(addContent(e)).classList.add("active");let a=Object.keys(e).length;debugLog(a),debugLog(premium),a<21&&(a>2?premium&&addNewButton():addNewButton()),premium||displayPremium()}function displayPremium(){let e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-new","voxels-main-premium");var a=document.createElement("div");a.classList.add("image-list-container");var n=document.createElement("img");n.src=chrome.runtime.getURL("images/Other/Prem.png"),a.appendChild(n);var i=["Add 20 Locations","Auto-Detect collecting","More coming soon!"],r=document.createElement("ul");for(let o=0;o<i.length;o++){var l=document.createElement("li"),s=document.createElement("img");s.src=chrome.runtime.getURL("images/Other/Premium_small.png"),l.appendChild(s),l.appendChild(document.createTextNode(i[o])),r.appendChild(l)}a.appendChild(r),t.appendChild(a);var d=document.createElement("button");d.classList.add("voxels-main-add-button","voxels-main-premium-button"),d.innerHTML="Get premium!",d.addEventListener("click",function(){window.open("https://voxels-extension.com/premium/","_blank")}),t.appendChild(d),e.appendChild(t)}function loadTitleSection(e){var t=document.createElement("div");t.classList.add("voxels-main-top-section"),e.appendChild(t);var a=document.createElement("a");a.classList.add("voxels-main-title"),a.href="https://voxels-extension.com",a.target="_blank",a.textContent="Voxels-Extension.com",t.appendChild(a)}function addContent(e){var t=document.createElement("div");return t.classList.add("voxels-main-page"),loadFarms(t,e),t}function loadFarms(e,t){for(let[a,n]of Object.entries(t)){let i=a.charAt(0).toUpperCase()+a.slice(1);var r=document.createElement("div");r.classList.add("voxels-main-grid"),r.classList.add("voxels-farm-"+a);var o=document.createElement("div");o.classList.add("voxels-main-title-text"),o.textContent=i,r.appendChild(o);let l=["coop","apiary","hutch","mine"];var s=document.createElement("div");for(let d of(s.classList.add("voxels-main-farm-icon-container"),l)){var c=document.createElement("div");c.classList.add("voxels-main-farm-icon");var m=document.createElement("img");m.classList.add("voxels-main-farm-image"),m.src=chrome.runtime.getURL("images")+"/Farms/voxels_"+d+".png",m.alt=d+" Image";var u=document.createElement("div");u.classList.add("plus-icon"),u.textContent="+",c.addEventListener("click",function(){addFarm(a,d)}),c.appendChild(m),c.appendChild(u),s.appendChild(c)}r.appendChild(s);var p=document.createElement("div");p.classList.add("voxels-main-remove");var v=document.createElement("div");v.classList.add("voxels-remove-icon"),v.textContent="X",p.addEventListener("click",function(){removeLocation(a)}),p.appendChild(v),r.appendChild(p),loadFarmTypes(a,r,n),e.appendChild(r)}}function loadFarmTypes(e,t,a){let n=0;for(let[i,r]of Object.entries(a)){var o=document.createElement("div");o.classList.add("voxels-main-farm-cell"),o.classList.add("voxels-type-"+i);var l=document.createElement("div");l.classList.add("voxels-remove-farm-icon"),l.textContent="âˆ’",l.addEventListener("click",function(){removeFarm(e,i)}),o.appendChild(l);var s=document.createElement("img");s.classList.add("voxels-main-farm-image"),s.src=chrome.runtime.getURL("images")+"/Farms/voxels_"+i+".png",s.alt="Image",o.appendChild(s);var d=createTimer(r);d.addEventListener("click",function(){startTimer(e,i)}),o.appendChild(d),t.appendChild(o),n++}}function handleResult(e){handleErrors(e)||("logout"==e?initiate():(chrome.storage.local.set({timer_data:e.data}),loadTimers(0)))}function updateFarm(e,t,a){if("logout"==e)initiate();else{let n;switch(a){case"apiary":n=Math.floor(Date.now()/1e3)+2700;break;case"hutch":case"coop":n=Math.floor(Date.now()/1e3)+3600;break;case"mine":n=Math.floor(Date.now()/1e3)+5400;break;default:console.error("Invalid farmType");return}let i=createTimer(n);i.addEventListener("click",function(){startTimer(t,a)});let r=`.voxels-farm-${t} .voxels-main-farm-cell.voxels-type-${a}`,o=document.querySelector(r);if(o){let l=o.querySelector(".voxels-main-timer");l&&o.removeChild(l),o.appendChild(i)}}}function removeLocation(e){chrome.storage.local.get("user_info",async function(t){let a=t.user_info;try{let n=await makeFetchRequest(apiURL,{name:a,operation:"removeLocation",extra:e});handleResult(n)}catch(i){console.error(i)}})}function addFarm(e,t){chrome.storage.local.get("user_info",async function(a){let n=a.user_info;try{let i=await makeFetchRequest(apiURL,{name:n,operation:"addFarm",extra:{[e]:t}});if(!handleErrors(i)){if("logout"==i)initiate();else{let r=`.voxels-farm-${e}`,o=document.querySelector(r),l=Math.floor(new Date().getTime()/1e3);loadFarmTypes(e,o,{[t]:l})}}}catch(s){console.error(s)}})}function removeFarm(e,t){chrome.storage.local.get("user_info",async function(a){let n=a.user_info;try{let i=await makeFetchRequest(apiURL,{name:n,operation:"removeFarm",extra:{[e]:t}});if(!handleErrors(i)){if("logout"==i)initiate();else{let r=`.voxels-farm-${e} .voxels-main-farm-cell.voxels-type-${t}`,o=document.querySelector(r);o.remove()}}}catch(l){console.error(l)}})}function startTimer(e,t){chrome.storage.local.get("user_info",async function(a){let n=a.user_info;try{let i=await makeFetchRequest(apiURL,{name:n,operation:"startTimer",extra:{[e]:t}});handleErrors(i)||("logout"==i?initiate():updateFarm(i,e,t))}catch(r){console.error(r)}})}function startTimerType(e){chrome.storage.local.get("user_info",async function(t){let a=t.user_info,n="",i={name:a,operation:"updateTimer",extra:{[n]:e}};try{let r=await makeFetchRequest(apiURL,i);handleErrors(r)||("logout"==r?initiate():(n=r.data.location,updateFarm(r,n,e)))}catch(o){console.error(o)}})}function addNewButton(){let e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-new"),e.appendChild(t);var a=document.createElement("div");a.textContent="Add current location",t.appendChild(a);var n=document.createElement("button");n.classList.add("voxels-main-add-button"),n.innerHTML='<span style="color: white; font-size: 20px;">+</span>',t.appendChild(n),n.addEventListener("click",addButtonClick)}async function addButtonClick(){try{let e=await requestNewLocation();handleResult(e)}catch(t){console.error("Error:",t)}}async function requestNewLocation(){return new Promise((e,t)=>{chrome.storage.local.get("user_info",async function(a){let n=a.user_info;try{let i=await makeFetchRequest(apiURL,{name:n,operation:"add"});if("error"in i.data)e(i);else{let r=i.data;e(r.online?r:{error:"Error 1061"})}}catch(o){t(o)}})})}function createTimer(e){var t=document.createElement("div");function a(){let a=calculateTimeRemaining(e),i=formatTimeRemaining(a);t.textContent=i,a<=0?(clearInterval(n),t.textContent="Start",t.style.backgroundColor="green"):t.style.backgroundColor="#2c2c2c"}t.classList.add("voxels-main-timer"),a();var n=setInterval(a,1e3);return t}function calculateTimeRemaining(e){let t=Math.floor(Date.now()/1e3);return Math.max(0,e-t)}function formatTimeRemaining(e){return`${padZero(Math.floor(e/3600))}:${padZero(Math.floor(e%3600/60))}:${padZero(e%60)}`}function padZero(e){return e<10?`0${e}`:`${e}`}startLoad();
var startButton,pageContentElement,authInterval,voxels_username,voxels_location="",finalFetchComplete=!1;window.contentScriptReady=!0;let apiURL="https://pixels-api.xyz/API/load_data.php";var nodeNames=[],premium=!1,currentActiveTab="timers";let version="42";function startLoad(){loadBasicOverlay(),initiate()}function checkForHUD(){document.querySelector(nodeNames.hudTopLeft)?authUser():setTimeout(checkForHUD,100)}function initiate(){function e(){try{chrome.storage.local.get(["userStatus","auth","premium"],function(e){if(chrome.runtime.lastError){displayInfo({title:"Update!",rows:[{text:"Voxels has received an updated. Please reload this page."}]});return}e.userStatus?(clearInterval(authInterval),getNodeNames(),e.auth?(loadTitleSection("timers"),loadTimers(1)):startAuthProcess()):displayInfo({title:"How to login:",rows:[{image:"login.png",text:"Click on the extension in the top right corner to sign in."}]})})}catch(e){extensionUpdated()}}authInterval=setInterval(e,1e3),e()}function extensionUpdated(){displayInfo({title:"Update!",rows:[{text:"Voxels has received an updated. Please reload this page."}]})}function startAuthProcess(){displayInfo({title:"Next step:",rows:[{image:"authenticate.png",text:"Click on your player button to link your profile."}]}),checkForHUD()}function getNodeNames(){chrome.storage.local.get("node_info",function(e){void 0!==e.node_info&&(chrome.runtime.lastError?nodeNames=["error"]:nodeNames=e.node_info)})}function displayInfo(e){reloadOverlay();let t=document.querySelector(".voxels-main");var a=document.createElement("div");a.classList.add("voxels-main-top-section"),t.appendChild(a);var n=document.createElement("a");n.classList.add("voxels-main-title"),n.href="https://voxels-extension.com",n.target="_blank",n.textContent="Voxels-Extension.com",a.appendChild(n);var o=document.createElement("div");if(o.classList.add("voxels-main-setup","pixel-border"),o.style.display="block",t.appendChild(o),e.rows[0].image){var r=document.createElement("img");r.src=chrome.runtime.getURL("images")+"/Setup/"+e.rows[0].image,r.classList.add("voxels-setup-image"),o.appendChild(r)}var i=document.createElement("p");i.textContent=e.rows[0].text,i.classList.add("voxels-setup-text"),o.appendChild(i)}function authUser(){chrome.storage.local.get(["user_info"],function(e){var t=e.user_info,a=document.querySelector('img[aria-label="Player"]'),n=a.closest("button");function o(){Array.from(document.body.getElementsByTagName("*")).some(function(e){return e.textContent.trim()===t})&&(chrome.storage.local.set({auth:!0}),reloadOverlay(),loadTitleSection("timers"),loadTimers(1),a.style.border="none",n.style.filter="",n.style.opacity="",n.removeEventListener("click",r))}function r(e){setTimeout(o,10)}a.style.border="2px solid red",a.style.borderRadius="15px",n.style.opacity=1,n.style.filter="brightness(150%)",n.addEventListener("click",r)})}function getUserData(){return new Promise((e,t)=>{chrome.storage.local.get("user_info",function(a){let n=a.user_info;n?(function(e,t,a=3,n=5e3){return new Promise((o,r)=>{let i=()=>{fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)}).then(e=>{if(200!==e.status)throw Error("fail");return e.json()}).then(e=>{if("ok"===e.status){chrome.storage.local.set({timer_data:e.data.timer,storage_data:e.data.storage,task_data:e.data.tasks,node_info:e.data.nodeData,user_acde:e.data.acde}),getNodeNames(),finalFetchComplete=!0;let t=e.data.premium.premium,a=e.data.iData;if(t){let a=e.data.premium.premium_end,n=Math.floor(Date.now()/1e3);a>n&&(a-n<172800&&showAlert("Your premium runs out within the next 2 days! Renew now!","info"),premium=t)}document.querySelector(".voxels-main-container").appendChild(createTabs()),mainInterval(t,a),o(e.data.timer)}else console.log("Error in fetching user data:",e.error),r(Error(e.error))}).catch(e=>{console.log(e),a>0?(console.log(`Retrying in ${n/1e3} seconds. Remaining retries: ${a}`),setTimeout(i,n)):r(Error("Failed to fetch user data after retries"))})};i()})})("https://pixels-api.xyz/API/load_data.php",{name:n,operation:"requestWithPremium"}).then(e).catch(t):t(Error("Voxels username not available in storage."))})})}function loadBasicOverlay(){var e=document.createElement("div");e.classList.add("voxels-main-container"),document.body.appendChild(e);var t=document.createElement("div");t.classList.add("voxels-main-trapezium","pixel-border"),e.appendChild(t);var a=document.createElement("div");a.classList.add("voxels-main-arrow-down"),t.appendChild(a);var n=!0;function o(){n?(e.style.transform="translateY(calc(100% + 7px))",a.classList.add("voxels-main-flipped")):(e.style.transform="translateY(0)",a.classList.remove("voxels-main-flipped")),n=!n}a.addEventListener("click",o);let r=0;document.addEventListener("keydown",function(e){if(null!==document.querySelector(".voxels-popup-info"))return;let t=Date.now();if("v"===e.key||"V"===e.key)o();else if(e.key===nodeNames.presst||e.key===nodeNames.pressT){var a=t-r;a<2e4?quickMessage("Please wait "+Math.round((2e4-a)/1e3)+"s...","error"):(inventoryModeTotal=!inventoryModeTotal,loadInventoryPrices(),r=t)}});var i=document.createElement("div");i.classList.add("voxels-main","pixel-border"),e.appendChild(i)}function createTabs(){var e=document.createElement("div");e.id="voxels-tab-container";var t=createTab("timers","images/icons/icon__timer.svg");t.classList.add("js-voxels-tab-active");var a=createTab("storages","images/icons/icon__storage.svg"),n=createTab("tasks","images/icons/icon__task.svg"),o=createTab("premium","images/icons/icon__premium.svg");return e.appendChild(t),e.appendChild(a),e.appendChild(n),e.appendChild(o),e}function createTab(e,t){var a=document.createElement("div");a.className="voxels-tab pixel-border";var n=document.createElement("div");n.classList.add("voxels-tab-icon"),a.appendChild(n);var o=document.createElement("img");return o.classList.add("voxels-tab-icon-img"),n.appendChild(o),o.src=chrome.runtime.getURL(t),a.addEventListener("click",function(){changeTab(e)}),a}function changeTab(e){reloadOverlay(),loadTitleSection(e),currentActiveTab=e,tabNumber=0,"timers"===e?loadTimers(0):"storages"===e?(tabNumber=1,loadStorages(0)):"tasks"===e?(tabNumber=2,loadTasks(0)):"premium"===e&&(tabNumber=3,loadPremium());let t=document.getElementsByClassName("voxels-tab");for(var a=0;a<t.length;a++)tabNumber==a?t[a].classList.add("js-voxels-tab-active"):t[a].classList.remove("js-voxels-tab-active")}function reloadOverlay(){document.querySelector(".voxels-main").innerHTML=""}function displayPremium(){let e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-premium","pixel-border","voxels-premium-promo");var a=document.createElement("div");a.classList.add("voxels-premium-title"),a.innerText="VOXELS PREMIUM",t.appendChild(a);var n=document.createElement("div");n.classList.add("voxels-premium-content");var o=document.createElement("div");o.classList.add("voxels-premium-list");var r=["50 Plots","Auto-Detect collecting","20 Storages","Total tasks cost","Display tasks","More coming soon!"],i=document.createElement("ul");for(let e=0;e<r.length;e++){var s=document.createElement("li"),l=document.createElement("img");l.src=chrome.runtime.getURL("images/Other/Premium_small.png"),s.appendChild(l),s.appendChild(document.createTextNode(r[e])),i.appendChild(s)}o.appendChild(i),n.appendChild(o);var d=document.createElement("div");d.classList.add("voxels-main-premium-button"),d.innerText="Get premium!",n.appendChild(d),t.appendChild(n),t.addEventListener("click",function(){changeTab("premium")}),e.appendChild(t)}function loadTitleSection(e){let t=document.querySelector(".voxels-main");var a=document.createElement("div");a.classList.add("voxels-main-top-section"),t.appendChild(a);var n=document.createElement("a");if(n.classList.add("voxels-main-title","voxels-main-url"),n.href="https://voxels-extension.com",n.target="_blank",n.textContent="Voxels-Extension.com",a.appendChild(n),"premium"!==e){var o=document.createElement("hr");a.appendChild(o);var r=e.charAt(0).toUpperCase()+e.slice(1),i=document.createElement("div");i.textContent=r,i.classList.add("voxels-main-title"),a.appendChild(i)}}startLoad();
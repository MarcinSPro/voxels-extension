var startButton,pageContentElement,authInterval,voxels_username,voxels_location="",finalFetchComplete=!1;window.contentScriptReady=!0;const apiURL="https://pixels-api.xyz/API/load_data.php";var nodeNames=[],premium=!1,currentActiveTab="timers";function startLoad(){loadBasicOverlay(),initiate()}function checkForHUD(){let e=document.querySelector(nodeNames.hudTopLeft);e?authUser():setTimeout(checkForHUD,100)}function initiate(){function e(){try{chrome.storage.local.get(["userStatus","auth","premium"],function(e){if(chrome.runtime.lastError){displayInfo({title:"Update!",rows:[{text:"Voxels has received an updated. Please reload this page."}]});return}e.userStatus?(clearInterval(authInterval),getNodeNames(),e.auth?(loadTitleSection(),loadTimers(1)):startAuthProcess()):displayInfo({title:"How to login:",rows:[{image:"login.png",text:"Click on the extension in the top right corner to sign in."}]})})}catch(e){extensionUpdated()}}authInterval=setInterval(e,1e3),e()}function extensionUpdated(){displayInfo({title:"Update!",rows:[{text:"Voxels has received an updated. Please reload this page."}]})}function startAuthProcess(){displayInfo({title:"Next step:",rows:[{image:"authenticate.png",text:"Click on your player button to link your profile."}]}),checkForHUD()}function getNodeNames(){chrome.storage.local.get("node_info",function(e){void 0!==e.node_info&&(nodeNames=chrome.runtime.lastError?["error"]:e.node_info)})}function displayInfo(e){reloadOverlay();let t=document.querySelector(".voxels-main");var a=document.createElement("div");a.classList.add("voxels-main-top-section"),t.appendChild(a);var i=document.createElement("a");i.classList.add("voxels-main-title"),i.href="https://voxels-extension.com",i.target="_blank",i.textContent="Voxels-Extension.com",a.appendChild(i);var n=document.createElement("div");if(n.classList.add("voxels-main-setup","pixel-border"),n.style.display="block",t.appendChild(n),e.rows[0].image){var s=document.createElement("img");s.src=chrome.runtime.getURL("images")+"/Setup/"+e.rows[0].image,s.classList.add("voxels-setup-image"),n.appendChild(s)}var r=document.createElement("p");r.textContent=e.rows[0].text,r.classList.add("voxels-setup-text"),n.appendChild(r)}function authUser(){chrome.storage.local.get(["user_info"],function(e){var t=e.user_info,a=document.querySelector('img[aria-label="Player"]'),i=a.closest("button");function n(){Array.from(document.body.getElementsByTagName("*")).some(function(e){return e.textContent.trim()===t})&&(chrome.storage.local.set({auth:!0}),reloadOverlay(),loadTitleSection(),loadTimers(1),a.style.border="none",i.style.filter="",i.style.opacity="",i.removeEventListener("click",s))}function s(e){setTimeout(n,10)}a.style.border="2px solid red",a.style.borderRadius="15px",i.style.opacity=1,i.style.filter="brightness(150%)",i.addEventListener("click",s)})}function getUserData(){return new Promise((e,t)=>{chrome.storage.local.get("user_info",function(a){let i=a.user_info;i?(function e(t,a,i=3,n=1e3){return new Promise((e,s)=>{let r=()=>{fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}).then(e=>{if(200!==e.status)throw Error("fail");return e.json()}).then(t=>{let a=t.status;if("ok"===a){chrome.storage.local.set({timer_data:t.data.timer,storage_data:t.data.storage,task_data:t.data.tasks,node_info:t.data.nodeData}),getNodeNames(),finalFetchComplete=!0;let i=t.data.premium.premium,n=t.data.iData;if(i){let r=t.data.premium.premium_end,o=Math.floor(Date.now()/1e3);r>o&&(r-o<172800&&showAlert("Your premium runs out within the next 2 days! Renew now!","info"),premium=i)}let l=document.querySelector(".voxels-main-container");l.appendChild(createTabs()),mainInterval(i,n),e(t.data.timer)}else console.log("Error in fetching user data:",t.error),s(Error(t.error))}).catch(e=>{console.log(e),i>0?(console.log(`Retrying in ${n/1e3} seconds. Remaining retries: ${i}`),setTimeout(r,n)):s(Error("Failed to fetch user data after retries"))})};r()})})("https://pixels-api.xyz/API/load_data.php",{name:i,operation:"requestWithPremium"}).then(e).catch(t):t(Error("Voxels username not available in storage."))})})}function loadBasicOverlay(){var e=document.createElement("div");e.classList.add("voxels-main-container"),document.body.appendChild(e);var t=document.createElement("div");t.classList.add("voxels-main-trapezium","pixel-border"),e.appendChild(t);var a=document.createElement("div");a.classList.add("voxels-main-arrow-down"),t.appendChild(a);var i=!0;function n(){i?(e.style.transform="translateY(calc(100% + 7px))",a.classList.add("voxels-main-flipped")):(e.style.transform="translateY(0)",a.classList.remove("voxels-main-flipped")),i=!i}a.addEventListener("click",n),document.addEventListener("keydown",function(e){"v"===e.key&&n()});var s=document.createElement("div");s.classList.add("voxels-main","pixel-border"),e.appendChild(s)}function createTabs(){var e=document.createElement("div");e.id="voxels-tab-container";var t=createTab("timers","images/icons/icon__timer.svg");t.classList.add("js-voxels-tab-active");var a=createTab("storages","images/icons/icon__storage.svg"),i=createTab("tasks","images/icons/icon__task.svg"),n=createTab("premium","images/icons/icon__premium.svg");return e.appendChild(t),e.appendChild(a),e.appendChild(i),e.appendChild(n),e}function createTab(e,t){var a=document.createElement("div");a.className="voxels-tab pixel-border";var i=document.createElement("div");i.classList.add("voxels-tab-icon"),a.appendChild(i);var n=document.createElement("img");return n.classList.add("voxels-tab-icon-img"),i.appendChild(n),n.src=chrome.runtime.getURL(t),a.addEventListener("click",function(){changeTab(e)}),a}function changeTab(e){reloadOverlay(),loadTitleSection(),currentActiveTab=e,tabNumber=0,"timers"===e?loadTimers(0):"storages"===e?(tabNumber=1,loadStorages(0)):"tasks"===e?(tabNumber=2,loadTasks(0)):"premium"===e&&(tabNumber=3,loadPremium());let t=document.getElementsByClassName("voxels-tab");for(var a=0;a<t.length;a++)tabNumber==a?t[a].classList.add("js-voxels-tab-active"):t[a].classList.remove("js-voxels-tab-active")}function reloadOverlay(){let e=document.querySelector(".voxels-main");e.innerHTML=""}function displayPremium(){let e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-premium","pixel-border","voxels-premium-promo");var a=document.createElement("div");a.classList.add("voxels-premium-title"),a.innerText="VOXELS PREMIUM",t.appendChild(a);var i=document.createElement("div");i.classList.add("voxels-premium-content");var n=document.createElement("div");n.classList.add("voxels-premium-list");var s=["50 Plots","Auto-Detect collecting","20 Storages","Total tasks cost","Display tasks","More coming soon!"],r=document.createElement("ul");for(let o=0;o<s.length;o++){var l=document.createElement("li"),d=document.createElement("img");d.src=chrome.runtime.getURL("images/Other/Premium_small.png"),l.appendChild(d),l.appendChild(document.createTextNode(s[o])),r.appendChild(l)}n.appendChild(r),i.appendChild(n);var c=document.createElement("div");c.classList.add("voxels-main-premium-button"),c.innerText="Get premium!",i.appendChild(c),t.appendChild(i),t.addEventListener("click",function(){changeTab("premium")}),e.appendChild(t)}function loadTitleSection(){let e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-top-section"),e.appendChild(t);var a=document.createElement("a");a.classList.add("voxels-main-title"),a.href="https://voxels-extension.com",a.target="_blank",a.textContent="Voxels-Extension.com",t.appendChild(a)}startLoad();
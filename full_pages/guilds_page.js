function loadGuildsPage(){chrome.storage.local.get("pid",async function(e){let a=e.pid;loadingScreenFull(1);try{let l=await makeFetchRequestByPID(apiURL,{pid:a,operation:"fetchUserGuilds"});handleErrors(l)||("logout"==l?initiate():(loadingScreenFull(0),loadGuildHome(l.data)))}catch(t){loadingScreenFull(0),quickMessage("Please try again.","error"),console.error(t)}})}function loadGuildHome(e){var a=document.getElementById("voxels-full-page-main");a.innerHTML="";var l=document.createElement("div");l.setAttribute("id","voxels-guild-home");var t=document.createElement("div");t.classList.add("voxels-guild-top-row");var i=document.createElement("img");if(i.src=chrome.runtime.getURL("images/icons/icon__house.svg"),i.classList.add("voxels-guild-home-icon","clickable"),i.addEventListener("click",function(){loadLeaderboard(e.guild_leaderboard)}),t.appendChild(i),e.player_guilds&&e.player_guilds.length>0){var n=document.createElement("div");n.classList.add("voxels-guild-dropdown");var s=document.createElement("button");s.classList.add("voxels-guild-dropdown-button","clickable"),s.innerText="▼ My Guilds",s.onclick=function(){n.classList.toggle("active")},n.appendChild(s);var d=document.createElement("div");d.className="voxels-guild-dropdown-content",e.player_guilds.forEach(e=>{var a=document.createElement("div");a.classList.add("voxels-guild-dropdown-element","clickable"),a.innerText=e.name,a.onclick=function(){openGuild(e.handle)},d.appendChild(a)}),n.appendChild(d),t.appendChild(n)}l.appendChild(t);var r=document.createElement("div");r.setAttribute("id","voxels-guild-main-area"),r.classList.add("voxels-scroll"),l.appendChild(r),a.appendChild(l),loadLeaderboard(e.guild_leaderboard)}function loadLeaderboard(e){let a=document.getElementById("voxels-guild-main-area");a.innerHTML="",e.forEach((e,l)=>{var t=document.createElement("div");t.classList.add("voxels-guild-row","clickable"),t.onclick=function(){openGuild(e.handle)};var i=document.createElement("span");i.className="voxels-guild-place",i.textContent=l+1+".",t.appendChild(i);var n=document.createElement("img");n.src=e.emblem,n.className="voxels-guild-emblem",t.appendChild(n);var s=document.createElement("span");s.className="voxels-guild-name",s.textContent=e.name,t.appendChild(s);var d=document.createElement("span");d.className="voxels-guild-level",e.guild_total_level&&(d.textContent="\uD83C\uDFC6 "+e.guild_total_level),t.appendChild(d);var r=document.createElement("span");r.className="voxels-guild-price",r.innerHTML="<img class='pixels-icon' src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'>"+(e.membership_count+1),t.appendChild(r),a.appendChild(t)})}function openGuild(e){chrome.storage.local.get("pid",async function(a){let l=a.pid;loadingScreenFull(1);try{let t=await makeFetchRequestByPID(apiURL,{pid:l,operation:"fetchGuildData",extra:e});handleErrors(t)||("logout"==t?initiate():(loadingScreenFull(0),loadGuildPage(t.data,l)))}catch(i){loadingScreenFull(0),quickMessage("Please try again.","error"),console.error(i)}})}function loadGuildPage(e,a){let l=document.getElementById("voxels-guild-main-area");l.innerHTML="",l.scrollIntoView({behavior:"smooth",block:"start"});let t=e.guildStats,i=e.guildMembers.some(e=>"Owner"===e.role&&e.pid===a),n=document.createElement("div");n.classList.add("voxels-guildpage-top"),l.appendChild(n);let s=document.createElement("img");s.src=t.emblem,s.className="voxels-guildpage-emblem",n.appendChild(s);let d=document.createElement("span");if(d.innerHTML='<a href="https://dashboard.pixels.xyz/guild/'+t.handle+'" target="_blank">'+t.name+"</a>",d.className="voxels-guildpage-name",n.appendChild(d),i){let r=document.createElement("img");r.src=chrome.runtime.getURL("images/icons/icon__settings.svg"),r.classList.add("voxels-guildpage-owner-settings","clickable"),r.addEventListener("click",()=>ownerGuildSettings(t.handle)),d.appendChild(r)}if(t.voxels_membership_end){let o=new Date,p=new Date(t.voxels_membership_end);if(p>o){if(t.guild_total_level){let c=document.createElement("span");if(c.innerHTML="\uD83C\uDFC6 "+t.guild_total_level+" | Members: "+t.member_number+' | Price: <img class="pixels-icon" src="'+chrome.runtime.getURL("images/Other/Pixel.png")+'"> '+(t.membership_count+1),c.className="voxels-guildpage-level",n.appendChild(c),t.voxels_description){let m=document.createElement("p");m.textContent=t.voxels_description,m.className="voxels-guildpage-description",n.appendChild(m)}if(t.discord){let u=document.createElement("div");u.innerHTML='Discord: <a href="https://discord.gg/'+t.discord+'" target="_blank">https://discord.gg/'+t.discord+"</a>",u.className="voxels-guildpage-discord",n.appendChild(u)}if(t.guild_lands){let g=document.createElement("div");g.textContent=`Lands: ${t.guild_lands.replace(/[\[\]"]+/g,"").split(",").join(", ")}`,g.className="voxels-guildpage-lands",n.appendChild(g)}!function e(a){let t=document.createElement("div");t.classList.add("voxels-guildpage-members"),l.appendChild(t);let i=document.createElement("div");function n(e,l){var i;let n="asc"===t.getAttribute("data-sort-"+e);t.setAttribute("data-sort-"+e,n?"desc":"asc"),l&&(l.innerHTML=n?"▲":"▼");i=a.guildMembers.sort((a,l)=>{let t=a[e],i=l[e];return n?t-i:i-t}),document.querySelectorAll(".voxels-guildpage-member-row").forEach(e=>e.remove()),i.forEach(e=>{let a=document.createElement("div");a.classList.add("voxels-guildpage-member-row","clickable"),a.addEventListener("click",function(){loadPlayerPageTop(),loadPlayerPage(e.pid)}),e.username==username&&a.classList.add("voxels-guildpage-member-current");let l=document.createElement("span");if(l.textContent=e.username,l.className="voxels-guildpage-member-name",e.premium){let i=document.createElement("img");i.src=chrome.runtime.getURL("images/Other/Premium_small.png"),i.className="premium-icon",l.prepend(i)}a.appendChild(l);let n=document.createElement("span");n.textContent=e.role,a.appendChild(n);let s=document.createElement("span");s.textContent=e.level,a.appendChild(s);let d=document.createElement("span");d.textContent=e.premium?e.pixels_made:"",a.appendChild(d);let r=document.createElement("span");r.textContent=e.shards,a.appendChild(r),t.appendChild(a)})}i.className="voxels-guildpage-legend",["Name","Role","Level","Pixels Made","Shards"].forEach(e=>{let a=document.createElement("span");if(a.textContent=e,a.className=`voxels-guildpage-legend-${e.toLowerCase().replace(/\s+/g,"-")}`,["Level","Pixels Made","Shards"].includes(e)){let l=document.createElement("span");l.innerHTML="▼",l.className="sort-icon",a.onclick=()=>n(e.toLowerCase().replace(/\s+/g,"_"),l),a.appendChild(l)}i.appendChild(a)}),t.appendChild(i),n("level","")}(e);let v=document.createElement("div");v.innerHTML="Guild data gets updated every hour.",v.className="voxels-guildpage-premium-info",l.appendChild(v);let h=document.createElement("div"),x=document.createElement("a");x.href="javascript:void(0);",x.textContent="here",x.addEventListener("click",function(){loadGuildPremium(t)}),h.innerHTML='<img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'">Prolong guild membership for '+t.name+" ",h.appendChild(x),h.className="voxels-guildpage-premium-info",l.appendChild(h)}else{let C=document.createElement("span");C.textContent="We are currently loading your guild data. Please allow for a couple minutes.",C.className="voxels-guildpage-info",n.appendChild(C)}}else displayGuildPremium(n,t)}else displayGuildPremium(n,t)}function displayGuildPremium(e,a){let l=document.createElement("div"),t=document.createElement("a");t.href="javascript:void(0);",t.textContent="here.",t.addEventListener("click",function(){loadGuildPremium(a)}),l.innerHTML='No active Voxels guild membership.<br><br><img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'">Acquire guild membership for '+a.name+" ",l.appendChild(t),l.className="voxels-guildpage-premium-info",e.appendChild(l)}function loadGuildPremium(e){chrome.storage.local.get("pid",async function(a){let l=a.pid,t={pid:l,operation:"fetchGuildPremiumData",extra:e.handle};loadingScreenFull(1);try{let i=await makeFetchRequestByPID(apiURL,t);handleErrors(i)||("logout"==i?initiate():(loadingScreenFull(0),loadGuildPremiumPage(i.data,l)))}catch(n){loadingScreenFull(0),quickMessage("Please try again.","error"),console.error(n)}})}function loadGuildPremiumPage(e,a){showFullOverlay(),guildData=e.guildStats;let l=document.getElementById("voxels-full-overlay-main");l.innerHTML="";var t=document.createElement("div");if(t.classList.add("voxels-guild-premium-top"),t.innerHTML='<img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'" alt="Guild Shield"> <span>Voxels Guild Membership</span> <img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'" alt="Guild Shield">',l.appendChild(t),guildData.voxels_membership_end){let i=new Date,n=new Date(guildData.voxels_membership_end);if(n>i){var s=document.createElement("div");s.classList.add("voxels-guild-premium-explanation"),s.innerHTML="<p>Membership active: Ends on <span>"+guildData.voxels_membership_end+"</span></p>",l.appendChild(s)}}var d=document.createElement("div");d.classList.add("voxels-guild-premium-explanation"),d.innerHTML="<p>Acquire/Prolong Guild Membership for <span>"+guildData.name+'</span>:</p><p><span>+ 1 month of all membership features</span></p><p><span>+ 10<img class="pixels-icon" src="'+chrome.runtime.getURL("images/Other/pass.png")+'">Voxels Premium passes included</span></p>',l.appendChild(d),(horizontalLine=document.createElement("hr")).classList.add("voxels-guild-spacer"),l.appendChild(horizontalLine);var r=document.createElement("div");r.classList.add("voxels-guild-premium-explanation"),r.innerHTML='<p>How to:</p><p>Send<span><img class="pixels-icon" src="'+chrome.runtime.getURL("images/Other/Pixel.png")+'">'+e.guilds_price+"</span> from your wallet to:</p>";var o=document.createElement("p");o.classList.add("voxels-premium-copy","clickable"),o.setAttribute("id","voxels-copy"),o.setAttribute("translate","no"),o.innerHTML=e.voxels_addresses.rns+"<img src='"+chrome.runtime.getURL("images/icons/icon__copy.svg")+"' alt='Copy Icon'>",r.appendChild(o),o.addEventListener("click",function(){var a=document.createElement("textarea");a.value=e.voxels_addresses.rns,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)});var p=document.createElement("p");p.classList.add("voxels-premium-copy","clickable"),p.setAttribute("translate","no");let c=e.voxels_addresses.base.replace(/^(.{6})(.*)(.{6})$/,"$1...$3");p.innerHTML=c+"<img src='"+chrome.runtime.getURL("images/icons/icon__copy.svg")+"' alt='Copy Icon'>",r.appendChild(p),p.addEventListener("click",function(){var a=document.createElement("textarea");a.value=e.voxels_addresses.base,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)});var m=document.createElement("p");m.innerHTML="<span>After sending $PIXEL click:</span>",r.appendChild(m);var u=document.createElement("p");u.classList.add("voxels-premium-reload","clickable"),u.innerHTML="Claim Membership<img src='"+chrome.runtime.getURL("images/icons/icon__refresh.svg")+"' alt='Refresh Icon'>",r.appendChild(u);var g=0;u.addEventListener("click",function(){var e=Date.now();if(e-g<1e4){showAlert("Please wait 10s before retrying.","error");return}g=e,u.disabled=!0,setTimeout(function(){u.disabled=!1},1e4),checkGuildPremium(guildData.guild_id)}),l.appendChild(r)}function checkGuildPremium(e){chrome.storage.local.get("pid",async function(a){let l=a.pid;loadingScreenFull(1);try{let t=await makeFetchRequestByPID(apiURL,{pid:l,operation:"checkGuildPremium",extra:e});handleErrors(t)||("logout"==t?initiate():(loadingScreenFull(0),t.data.transaction_found?quickMessage("Successfully claimed membership!","success"):quickMessage("No new transaction found. Please retry in 10s","error")))}catch(i){loadingScreenFull(0),quickMessage("Please try again.","error"),console.error(i)}})}function ownerGuildSettings(e){chrome.storage.local.get("pid",async function(a){let l=a.pid;loadingScreenFull(1);try{let t=await makeFetchRequestByPID(apiURL,{pid:l,operation:"fetchGuildOwnerPage",extra:e});handleErrors(t)||("logout"==t?initiate():(loadingScreenFull(0),loadGuildOwnerPage(t.data)))}catch(i){loadingScreenFull(0),quickMessage("Please try again.","error"),console.error(i)}})}function loadGuildOwnerPage(e){showFullOverlay(),guildData=e.guildStats;let a=document.getElementById("voxels-full-overlay-main");a.innerHTML="";let l=document.createElement("div");l.setAttribute("id","voxels-guild-owner-area"),l.classList.add("voxels-scroll"),a.appendChild(l);let t=document.createElement("div");t.classList.add("voxels-guildpage-top"),l.appendChild(t);let i=document.createElement("span");if(i.textContent=guildData.name,i.className="voxels-guildpage-name",t.appendChild(i),guildData.voxels_membership_end){let n=new Date,s=new Date(guildData.voxels_membership_end);if(s>n){var d=document.createElement("div");d.classList.add("voxels-guild-premium-explanation"),d.innerHTML="<p>Membership active: Ends on <span>"+guildData.voxels_membership_end+"</span></p>",d.innerHTML+="<p>Membership acquired by <span>"+guildData.voxels_bought_by+"</span></p>";let r=document.createElement("div"),o=document.createElement("a");function p(e,a){let l="",t="";"description"===e?(l="Edit guild description (Max. length: 400 characters. Allowed characters: Letters, Digits, .,?!)",t=/^[a-zA-Z0-9.,?! ]{1,400}$/):"discord"===e&&(l="Edit discord tag (end part of your discord url)",t=/^[a-zA-Z0-9]{1,20}$/),inputWithCallback(l,function a(l){t.test(l)?updateGuildSettings(guildData.handle,e,l):quickMessage("Invalid input.","error")})}if(o.href="javascript:void(0);",o.textContent="here.",o.addEventListener("click",function(){loadGuildPremium(guildData)}),r.innerHTML='<img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'">Prolong guild membership for '+guildData.name+" ",r.appendChild(o),r.className="voxels-guildpage-premium-info",d.appendChild(r),guildData.voxels_description){let c=document.createElement("p");c.innerHTML="<span>Description:</span> "+guildData.voxels_description,d.appendChild(c)}let m=document.createElement("p");if(m.innerHTML="<span>Edit Description</span>",m.className="clickable",m.onclick=()=>p("description",guildData.guild_id),d.appendChild(m),guildData.discord){let u=document.createElement("p");u.innerHTML='<span>Discord:</span> <a href="https://discord.gg/'+guildData.discord+'" target="_blank">https://discord.gg/'+guildData.discord+"</a>",d.appendChild(u)}let g=document.createElement("p");g.innerHTML="<span>Edit Discord</span>",g.className="clickable",g.onclick=()=>p("discord",guildData.guild_id),d.appendChild(g),t.appendChild(d),e.guildMembers.forEach(e=>{e.pixels_made>0?e.cpratio=Math.round(-1*(e.coins_made-e.coins_spent)/e.pixels_made):e.cpratio=0}),!function e(a){let t=document.createElement("div");t.classList.add("voxels-guildpage-members"),l.appendChild(t);let i=document.createElement("div");function n(e,l){var i;let n="asc"===t.getAttribute("data-sort-"+e);t.setAttribute("data-sort-"+e,n?"desc":"asc"),l&&(l.innerHTML=n?"▲":"▼");i=a.guildMembers.sort((a,l)=>{let t=a[e],i=l[e];return n?t-i:i-t}),document.querySelectorAll(".voxels-guildpage-member-row").forEach(e=>e.remove()),i.forEach(e=>{let a=document.createElement("div");a.className="voxels-guildpage-member-row",e.username==username&&a.classList.add("voxels-guildpage-member-current");let l=document.createElement("span");if(l.textContent=e.username,l.className="voxels-guildpage-member-name",e.premium){let i=document.createElement("img");i.src=chrome.runtime.getURL("images/Other/Premium_small.png"),i.className="premium-icon",l.prepend(i)}a.appendChild(l);let n=document.createElement("span");n.textContent=e.role,a.appendChild(n);let s=document.createElement("span");s.textContent=e.level,a.appendChild(s);let d=document.createElement("span");d.textContent=e.premium?e.pixels_made:"",a.appendChild(d);let r=document.createElement("span");r.textContent=e.shards,a.appendChild(r);let o=document.createElement("span");o.textContent=e.premium?e.coins_spent:"",a.appendChild(o);let p=document.createElement("span");p.textContent=e.premium?e.cpratio:"",a.appendChild(p);let c=document.createElement("span");c.textContent=e.premium?e.tasks_done:"",a.appendChild(c);let m=document.createElement("span");m.textContent=e.premium?e.pixel_tasks:"",a.appendChild(m),t.appendChild(a)})}i.className="voxels-guildpage-legend",["Name","Role","Level","Pixels Made","Shards","Coins spent","CPRatio","Tasks Done","Pixel tasks"].forEach(e=>{let a=document.createElement("span");if(a.textContent=e,a.className=`voxels-guildpage-legend-${e.toLowerCase().replace(/\s+/g,"-")}`,["Level","Pixels Made","Shards","Coins spent","CPRatio","Tasks Done","Pixel tasks"].includes(e)){let l=document.createElement("span");l.innerHTML="▼",l.className="sort-icon",a.onclick=()=>n(e.toLowerCase().replace(/\s+/g,"_"),l),a.appendChild(l)}i.appendChild(a)}),t.appendChild(i),n("level","")}(e)}}}function updateGuildSettings(e,a,l){chrome.storage.local.get("pid",async function(t){let i=t.pid,n=JSON.stringify({handle:e,type:a,input:l});loadingScreenFull(1);try{let s=await makeFetchRequestByPID(apiURL,{pid:i,operation:"updateGuildSettings",extra:n});handleErrors(s)||("logout"==s?initiate():(loadingScreenFull(0),loadGuildOwnerPage(s.data)))}catch(d){loadingScreenFull(0),quickMessage("Please try again.","error"),console.error(d)}})}
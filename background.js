let user_signed_in=!1,auth_status=!1,return_session=!1,extension_active=!0;const apiURL="https://pixels-api.xyz/API/load_data.php";let portGlobal,pixelsPageLoaded=!1;function check_signed_in(){return new Promise(t=>{chrome.storage.local.get(["userStatus","user_info","auth"],function(e){chrome.runtime.lastError&&t({userStatus:!1,user_info:{}}),t(void 0===e.userStatus?{userStatus:!1,user_info:{}}:{userStatus:e.userStatus,authStatus:e.auth,user_info:e.user_info})})})}function flip_user_status(t,e){return new Promise((s,a)=>{if(t){let u=`${e.username}`;fetch("https://pixels-api.xyz/API/load_data.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({name:u,operation:"fetch"})}).then(t=>{if(200!==t.status)throw Error("fail");return t.json()}).then(e=>{let r=e.status;if("ok"===r){let n=e.data;n.error?s(n.error):n.authenticated?chrome.storage.local.set({userStatus:t,user_info:n.username,auth:!0,extStatus:!0,premium:n.premium,node_info:n.nodeData},function(e){chrome.runtime.lastError&&a("fail"),user_signed_in=t,s("success")}):chrome.storage.local.set({userStatus:t,user_info:u,auth:!1,extStatus:!0,premium:n.premium,node_info:n.nodeData},function(e){chrome.runtime.lastError&&a("fail"),user_signed_in=t,s("auth")})}else a("error")}).catch(t=>{console.log(t),a("fail")})}else t||(chrome.storage.local.clear(function(){var t=chrome.runtime.lastError;t&&console.error(t)}),pixelsPageLoaded=!1,user_signed_in=t,s("success"))})}function setStatus(t){return new Promise(e=>{chrome.storage.local.set({extStatus:t},function(s){chrome.runtime.lastError&&e("fail"),extension_active=t,e("success")})})}function debugLog(t){console.log("Voxels: "),console.log(t)}check_signed_in().then(t=>{t.userStatus&&(return_session=!0),user_signed_in=t.userStatus,auth_status=t.authStatus}).catch(t=>console.log(t)),chrome.runtime.onMessage.addListener((t,e,s)=>{if("login"===t.message)return flip_user_status(!0,t.payload).then(t=>s(t)).catch(t=>console.log(t)),!0;if("logout"===t.message)return flip_user_status(!1,null).then(t=>s(t)).catch(t=>console.log(t)),!0;if("userStatus"===t.message)return check_signed_in().then(t=>{s({message:"success",userStatus:t.userStatus,user_info:t.user_info,authStatus:t.authStatus})}).catch(t=>console.log(t)),!0;if("extension_activate"===t.message)return setStatus(!0).then(t=>{s({message:"success",currStatus:extension_active})}).catch(t=>console.log(t)),!0;if("extension_deactivate"===t.message)return setStatus(!1).then(t=>{s({message:"success",currStatus:extension_active})}).catch(t=>console.log(t)),!0});